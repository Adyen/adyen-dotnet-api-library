// <auto-generated>
/*
 * Management API
 *
 * Configure and manage your Adyen company and merchant accounts, stores, and payment terminals. ## Authentication Each request to the Management API must be signed with an API key. [Generate your API key](https://docs.adyen.com/development-resources/api-credentials#generate-api-key) in the Customer Area and then set this key to the `X-API-Key` header value.  To access the live endpoints, you need to generate a new API key in your live Customer Area. ## Versioning  Management API handles versioning as part of the endpoint URL. For example, to send a request to this version of the `/companies/{companyId}/webhooks` endpoint, use:  ```text https://management-test.adyen.com/v3/companies/{companyId}/webhooks ```  ## Going live  To access the live endpoints, you need an API key from your live Customer Area. Use this API key to make requests to:  ```text https://management-live.adyen.com/v3 ```  ## Release notes Have a look at the [release notes](https://docs.adyen.com/release-notes/management-api) to find out what changed in this version!
 *
 * The version of the OpenAPI document: 3
 * Generated by: https://github.com/openapitools/openapi-generator.git
 */

#nullable enable

using System;
using System.Collections.Generic;
using System.Net;
using System.Threading.Tasks;
using Microsoft.Extensions.Logging;
using System.Net.Http;
using System.Net.Http.Headers;
using System.Text.Json;
using Adyen.Core;
using Adyen.Core.Auth;
using Adyen.Core.Client;
using Adyen.Management.Client;
using Adyen.Management.Models;
using System.Diagnostics.CodeAnalysis;

namespace Adyen.Management.Services
{
    /// <summary>
    /// Represents a collection of functions to interact with the API endpoints.
    /// This class is registered as transient.
    /// </summary>
    public interface IWebhooksMerchantLevelService : IAdyenApiService
    {
        /// <summary>
        /// The class containing the events.
        /// </summary>
        WebhooksMerchantLevelServiceEvents Events { get; }

        /// <summary>
        /// Generate an HMAC key
        /// </summary>
        /// <remarks>
        /// Returns an [HMAC key](https://en.wikipedia.org/wiki/HMAC) for the webhook identified in the path. This key allows you to check the integrity and the origin of the notifications you receive.By creating an HMAC key, you start receiving [HMAC-signed notifications](https://docs.adyen.com/development-resources/webhooks/verify-hmac-signatures#enable-hmac-signatures) from Adyen. Find out more about how to [verify HMAC signatures](https://docs.adyen.com/development-resources/webhooks/verify-hmac-signatures).  To make this request, your API credential must have the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read and write
        /// </remarks>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="webhookId"></param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="IGenerateHmacKeyApiResponse"/>&gt;</returns>
        Task<IGenerateHmacKeyApiResponse> GenerateHmacKeyAsync(string merchantId, string webhookId, System.Threading.CancellationToken cancellationToken = default);

        /// <summary>
        /// Get a webhook
        /// </summary>
        /// <remarks>
        /// Returns the configuration for the webhook identified in the path.  To make this request, your API credential must have one of the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read * Management API—Webhooks read and write
        /// </remarks>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="webhookId">Unique identifier of the webhook configuration.</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="IGetWebhookApiResponse"/>&gt;</returns>
        Task<IGetWebhookApiResponse> GetWebhookAsync(string merchantId, string webhookId, System.Threading.CancellationToken cancellationToken = default);

        /// <summary>
        /// List all webhooks
        /// </summary>
        /// <remarks>
        /// Lists all webhook configurations for the merchant account.  &gt; This call does not return webhook configurations for the company account to which the specified merchant account belongs. You can see these in your Customer Area under **Developers** &gt; **Webhooks**.  To make this request, your API credential must have one of the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read * Management API—Webhooks read and write
        /// </remarks>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="pageNumber">The number of the page to fetch. (optional)</param>
        /// <param name="pageSize">The number of items to have on a page, maximum 100. The default is 10 items on a page. (optional)</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="IListAllWebhooksApiResponse"/>&gt;</returns>
        Task<IListAllWebhooksApiResponse> ListAllWebhooksAsync(string merchantId, Option<int> pageNumber = default, Option<int> pageSize = default, System.Threading.CancellationToken cancellationToken = default);

        /// <summary>
        /// Remove a webhook
        /// </summary>
        /// <remarks>
        /// Remove the configuration for the webhook identified in the path.  To make this request, your API credential must have the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read and write
        /// </remarks>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="webhookId">Unique identifier of the webhook configuration.</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="IRemoveWebhookApiResponse"/>&gt;</returns>
        Task<IRemoveWebhookApiResponse> RemoveWebhookAsync(string merchantId, string webhookId, System.Threading.CancellationToken cancellationToken = default);

        /// <summary>
        /// Set up a webhook
        /// </summary>
        /// <remarks>
        /// Subscribe to receive webhook notifications about events related to your merchant account. You can add basic authentication to make sure the data is secure.  To make this request, your API credential must have the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read and write
        /// </remarks>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="createMerchantWebhookRequest"> (optional)</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="ISetUpWebhookApiResponse"/>&gt;</returns>
        Task<ISetUpWebhookApiResponse> SetUpWebhookAsync(string merchantId, Option<CreateMerchantWebhookRequest> createMerchantWebhookRequest = default, System.Threading.CancellationToken cancellationToken = default);

        /// <summary>
        /// Test a webhook
        /// </summary>
        /// <remarks>
        /// Sends sample notifications to test if the webhook is set up correctly.  We send four test notifications for each event code you choose. They cover success and failure scenarios for the hard-coded currencies EUR and GBP, regardless of the currencies configured in the merchant accounts. For custom notifications, we only send the specified custom notification.  The response describes the result of the test. The &#x60;status&#x60; field tells you if the test was successful or not. You can use the other fields to troubleshoot unsuccessful tests.  To make this request, your API credential must have the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read and write
        /// </remarks>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="webhookId">Unique identifier of the webhook configuration.</param>
        /// <param name="testWebhookRequest"> (optional)</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="ITestWebhookApiResponse"/>&gt;</returns>
        Task<ITestWebhookApiResponse> TestWebhookAsync(string merchantId, string webhookId, Option<TestWebhookRequest> testWebhookRequest = default, System.Threading.CancellationToken cancellationToken = default);

        /// <summary>
        /// Update a webhook
        /// </summary>
        /// <remarks>
        /// Make changes to the configuration of the webhook identified in the path. The request contains the new values you want to have in the webhook configuration. The response contains the full configuration for the webhook, which includes the new values from the request.  To make this request, your API credential must have the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read and write
        /// </remarks>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="webhookId">Unique identifier of the webhook configuration.</param>
        /// <param name="updateMerchantWebhookRequest"> (optional)</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="IUpdateWebhookApiResponse"/>&gt;</returns>
        Task<IUpdateWebhookApiResponse> UpdateWebhookAsync(string merchantId, string webhookId, Option<UpdateMerchantWebhookRequest> updateMerchantWebhookRequest = default, System.Threading.CancellationToken cancellationToken = default);

    }

    /// <summary>
    /// Represents a collection of functions to interact with the API endpoints.
    /// </summary>
    public class WebhooksMerchantLevelServiceEvents
    {
        /// <summary>
        /// The event raised after the server response.
        /// </summary>
        public event EventHandler<ApiResponseEventArgs>? OnGenerateHmacKey;

        /// <summary>
        /// The event raised after an error querying the server.
        /// </summary>
        public event EventHandler<ExceptionEventArgs>? OnErrorGenerateHmacKey;

        internal void ExecuteOnGenerateHmacKey(WebhooksCompanyLevelService.GenerateHmacKeyApiResponse apiResponse)
        {
            OnGenerateHmacKey?.Invoke(this, new ApiResponseEventArgs(apiResponse));
        }

        internal void ExecuteOnErrorGenerateHmacKey(Exception exception)
        {
            OnErrorGenerateHmacKey?.Invoke(this, new ExceptionEventArgs(exception));
        }

        /// <summary>
        /// The event raised after the server response.
        /// </summary>
        public event EventHandler<ApiResponseEventArgs>? OnGetWebhook;

        /// <summary>
        /// The event raised after an error querying the server.
        /// </summary>
        public event EventHandler<ExceptionEventArgs>? OnErrorGetWebhook;

        internal void ExecuteOnGetWebhook(WebhooksCompanyLevelService.GetWebhookApiResponse apiResponse)
        {
            OnGetWebhook?.Invoke(this, new ApiResponseEventArgs(apiResponse));
        }

        internal void ExecuteOnErrorGetWebhook(Exception exception)
        {
            OnErrorGetWebhook?.Invoke(this, new ExceptionEventArgs(exception));
        }

        /// <summary>
        /// The event raised after the server response.
        /// </summary>
        public event EventHandler<ApiResponseEventArgs>? OnListAllWebhooks;

        /// <summary>
        /// The event raised after an error querying the server.
        /// </summary>
        public event EventHandler<ExceptionEventArgs>? OnErrorListAllWebhooks;

        internal void ExecuteOnListAllWebhooks(WebhooksCompanyLevelService.ListAllWebhooksApiResponse apiResponse)
        {
            OnListAllWebhooks?.Invoke(this, new ApiResponseEventArgs(apiResponse));
        }

        internal void ExecuteOnErrorListAllWebhooks(Exception exception)
        {
            OnErrorListAllWebhooks?.Invoke(this, new ExceptionEventArgs(exception));
        }

        /// <summary>
        /// The event raised after the server response.
        /// </summary>
        public event EventHandler<ApiResponseEventArgs>? OnRemoveWebhook;

        /// <summary>
        /// The event raised after an error querying the server.
        /// </summary>
        public event EventHandler<ExceptionEventArgs>? OnErrorRemoveWebhook;

        internal void ExecuteOnRemoveWebhook(WebhooksCompanyLevelService.RemoveWebhookApiResponse apiResponse)
        {
            OnRemoveWebhook?.Invoke(this, new ApiResponseEventArgs(apiResponse));
        }

        internal void ExecuteOnErrorRemoveWebhook(Exception exception)
        {
            OnErrorRemoveWebhook?.Invoke(this, new ExceptionEventArgs(exception));
        }

        /// <summary>
        /// The event raised after the server response.
        /// </summary>
        public event EventHandler<ApiResponseEventArgs>? OnSetUpWebhook;

        /// <summary>
        /// The event raised after an error querying the server.
        /// </summary>
        public event EventHandler<ExceptionEventArgs>? OnErrorSetUpWebhook;

        internal void ExecuteOnSetUpWebhook(WebhooksCompanyLevelService.SetUpWebhookApiResponse apiResponse)
        {
            OnSetUpWebhook?.Invoke(this, new ApiResponseEventArgs(apiResponse));
        }

        internal void ExecuteOnErrorSetUpWebhook(Exception exception)
        {
            OnErrorSetUpWebhook?.Invoke(this, new ExceptionEventArgs(exception));
        }

        /// <summary>
        /// The event raised after the server response.
        /// </summary>
        public event EventHandler<ApiResponseEventArgs>? OnTestWebhook;

        /// <summary>
        /// The event raised after an error querying the server.
        /// </summary>
        public event EventHandler<ExceptionEventArgs>? OnErrorTestWebhook;

        internal void ExecuteOnTestWebhook(WebhooksCompanyLevelService.TestWebhookApiResponse apiResponse)
        {
            OnTestWebhook?.Invoke(this, new ApiResponseEventArgs(apiResponse));
        }

        internal void ExecuteOnErrorTestWebhook(Exception exception)
        {
            OnErrorTestWebhook?.Invoke(this, new ExceptionEventArgs(exception));
        }

        /// <summary>
        /// The event raised after the server response.
        /// </summary>
        public event EventHandler<ApiResponseEventArgs>? OnUpdateWebhook;

        /// <summary>
        /// The event raised after an error querying the server.
        /// </summary>
        public event EventHandler<ExceptionEventArgs>? OnErrorUpdateWebhook;

        internal void ExecuteOnUpdateWebhook(WebhooksCompanyLevelService.UpdateWebhookApiResponse apiResponse)
        {
            OnUpdateWebhook?.Invoke(this, new ApiResponseEventArgs(apiResponse));
        }

        internal void ExecuteOnErrorUpdateWebhook(Exception exception)
        {
            OnErrorUpdateWebhook?.Invoke(this, new ExceptionEventArgs(exception));
        }
    }

    /// <summary>
    /// Represents a collection of functions to interact with the API endpoints.
    /// </summary>
    public sealed partial class WebhooksMerchantLevelService : IWebhooksMerchantLevelService
    {
        private JsonSerializerOptions _jsonSerializerOptions;

        /// <summary>
        /// The logger factory.
        /// </summary>
        public ILoggerFactory LoggerFactory { get; }

        /// <summary>
        /// The logger.
        /// </summary>
        public ILogger<WebhooksMerchantLevelService> Logger { get; }

        /// <summary>
        /// The HttpClient.
        /// </summary>
        public System.Net.Http.HttpClient HttpClient { get; }

        /// <summary>
        /// The class containing the events.
        /// </summary>
        public WebhooksMerchantLevelServiceEvents Events { get; }

        /// <summary>
        /// A token provider of type <see cref="ApiKeyProvider"/>.
        /// </summary>
        public ITokenProvider<ApiKeyToken> ApiKeyProvider { get; }

        /// <summary>
        /// Initializes a new instance of the <see cref="WebhooksMerchantLevelService"/> class.
        /// </summary>
        /// <returns></returns>
        public WebhooksMerchantLevelService(ILogger<WebhooksMerchantLevelService> logger, ILoggerFactory loggerFactory, System.Net.Http.HttpClient httpClient, JsonSerializerOptionsProvider jsonSerializerOptionsProvider, WebhooksMerchantLevelServiceEvents webhooksMerchantLevelServiceEvents,
            ITokenProvider<ApiKeyToken> apiKeyProvider)
        {
            _jsonSerializerOptions = jsonSerializerOptionsProvider.Options;
            LoggerFactory = loggerFactory;
            Logger = LoggerFactory.CreateLogger<WebhooksMerchantLevelService>();
            HttpClient = httpClient;
            Events = webhooksMerchantLevelServiceEvents;
            ApiKeyProvider = apiKeyProvider;
        }

        partial void FormatGenerateHmacKey(ref string merchantId, ref string webhookId);

        /// <summary>
        /// Validates the request parameters.
        /// </summary>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <returns></returns>
        private void ValidateGenerateHmacKey(string merchantId, string webhookId)
        {
            if (merchantId == null)
                throw new ArgumentNullException(nameof(merchantId));

            if (webhookId == null)
                throw new ArgumentNullException(nameof(webhookId));
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        private void AfterGenerateHmacKeyDefaultImplementation(IGenerateHmacKeyApiResponse apiResponse, string merchantId, string webhookId)
        {
            bool suppressDefaultLog = false;
            AfterGenerateHmacKey(ref suppressDefaultLog, apiResponse, merchantId, webhookId);
            if (!suppressDefaultLog)
                Logger.LogInformation("{0,-9} | {1} | {3}", (apiResponse.DownloadedAt - apiResponse.RequestedAt).TotalSeconds, apiResponse.StatusCode, apiResponse.Path);
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        partial void AfterGenerateHmacKey(ref bool suppressDefaultLog, IGenerateHmacKeyApiResponse apiResponse, string merchantId, string webhookId);

        /// <summary>
        /// Logs exceptions that occur while retrieving the server response.
        /// </summary>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        private void OnErrorGenerateHmacKeyDefaultImplementation(Exception exception, string pathFormat, string path, string merchantId, string webhookId)
        {
            bool suppressDefaultLog = false;
            OnErrorGenerateHmacKey(ref suppressDefaultLog, exception, pathFormat, path, merchantId, webhookId);
            if (!suppressDefaultLog)
                Logger.LogError(exception, "An error occurred while sending the request to the server.");
        }

        /// <summary>
        /// A partial method that gives developers a way to provide customized exception handling.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        partial void OnErrorGenerateHmacKey(ref bool suppressDefaultLog, Exception exception, string pathFormat, string path, string merchantId, string webhookId);

        /// <summary>
        /// Generate an HMAC key Returns an [HMAC key](https://en.wikipedia.org/wiki/HMAC) for the webhook identified in the path. This key allows you to check the integrity and the origin of the notifications you receive.By creating an HMAC key, you start receiving [HMAC-signed notifications](https://docs.adyen.com/development-resources/webhooks/verify-hmac-signatures#enable-hmac-signatures) from Adyen. Find out more about how to [verify HMAC signatures](https://docs.adyen.com/development-resources/webhooks/verify-hmac-signatures).  To make this request, your API credential must have the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read and write
        /// </summary>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="webhookId"></param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="IGenerateHmacKeyApiResponse"/>&gt;</returns>
        public async Task<IGenerateHmacKeyApiResponse> GenerateHmacKeyAsync(string merchantId, string webhookId, System.Threading.CancellationToken cancellationToken = default)
        {
            UriBuilder uriBuilder = new UriBuilder();

            try
            {
                ValidateGenerateHmacKey(merchantId, webhookId);

                FormatGenerateHmacKey(ref merchantId, ref webhookId);

                using (HttpRequestMessage httpRequestMessage = new HttpRequestMessage())
                {
                    uriBuilder.Host = HttpClient.BaseAddress!.Host;
                    uriBuilder.Port = HttpClient.BaseAddress.Port;
                    uriBuilder.Scheme = HttpClient.BaseAddress.Scheme;
                    uriBuilder.Path = HttpClient.BaseAddress.AbsolutePath == "/"
                        ? "/merchants/{merchantId}/webhooks/{webhookId}/generateHmac"
                        : string.Concat(HttpClient.BaseAddress.AbsolutePath, "/merchants/{merchantId}/webhooks/{webhookId}/generateHmac");
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BmerchantId%7D", Uri.EscapeDataString(merchantId.ToString()));
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BwebhookId%7D", Uri.EscapeDataString(webhookId.ToString()));

                    ApiKeyToken apiKeyToken2 = (ApiKeyToken) ApiKeyProvider.Get();
                    apiKeyToken2.AddTokenToHttpRequestMessageHeader(httpRequestMessage);
                    httpRequestMessage.RequestUri = uriBuilder.Uri;

                    string[] accepts = new string[] {
                        "application/json"
                    };

                    string? accept = ClientUtils.SelectHeaderAccept(accepts);

                    if (accept != null)
                        httpRequestMessage.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue(accept));

                    httpRequestMessage.Method = HttpMethod.Post;

                    DateTime requestedAt = DateTime.UtcNow;

                    using (HttpResponseMessage httpResponseMessage = await HttpClient.SendAsync(httpRequestMessage, cancellationToken).ConfigureAwait(false))
                    {
                        ILogger<WebhooksCompanyLevelService.GenerateHmacKeyApiResponse> apiResponseLogger = LoggerFactory.CreateLogger<WebhooksCompanyLevelService.GenerateHmacKeyApiResponse>();
                        WebhooksCompanyLevelService.GenerateHmacKeyApiResponse apiResponse;

                        switch ((int)httpResponseMessage.StatusCode) {
                            default: {
                                string responseContent = await httpResponseMessage.Content.ReadAsStringAsync(cancellationToken).ConfigureAwait(false);
                                apiResponse = new(apiResponseLogger, httpRequestMessage, httpResponseMessage, responseContent, "/merchants/{merchantId}/webhooks/{webhookId}/generateHmac", requestedAt, _jsonSerializerOptions);

                                break;
                            }
                        }

                        AfterGenerateHmacKeyDefaultImplementation(apiResponse, merchantId, webhookId);

                        Events.ExecuteOnGenerateHmacKey(apiResponse);
                    
                        return apiResponse;
                    }
                }
            }
            catch(Exception e)
            {
                OnErrorGenerateHmacKeyDefaultImplementation(e, "/merchants/{merchantId}/webhooks/{webhookId}/generateHmac", uriBuilder.Path, merchantId, webhookId);
                Events.ExecuteOnErrorGenerateHmacKey(e);
                throw;
            }
        }

        partial void FormatGetWebhook(ref string merchantId, ref string webhookId);

        /// <summary>
        /// Validates the request parameters.
        /// </summary>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <returns></returns>
        private void ValidateGetWebhook(string merchantId, string webhookId)
        {
            if (merchantId == null)
                throw new ArgumentNullException(nameof(merchantId));

            if (webhookId == null)
                throw new ArgumentNullException(nameof(webhookId));
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        private void AfterGetWebhookDefaultImplementation(IGetWebhookApiResponse apiResponse, string merchantId, string webhookId)
        {
            bool suppressDefaultLog = false;
            AfterGetWebhook(ref suppressDefaultLog, apiResponse, merchantId, webhookId);
            if (!suppressDefaultLog)
                Logger.LogInformation("{0,-9} | {1} | {3}", (apiResponse.DownloadedAt - apiResponse.RequestedAt).TotalSeconds, apiResponse.StatusCode, apiResponse.Path);
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        partial void AfterGetWebhook(ref bool suppressDefaultLog, IGetWebhookApiResponse apiResponse, string merchantId, string webhookId);

        /// <summary>
        /// Logs exceptions that occur while retrieving the server response.
        /// </summary>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        private void OnErrorGetWebhookDefaultImplementation(Exception exception, string pathFormat, string path, string merchantId, string webhookId)
        {
            bool suppressDefaultLog = false;
            OnErrorGetWebhook(ref suppressDefaultLog, exception, pathFormat, path, merchantId, webhookId);
            if (!suppressDefaultLog)
                Logger.LogError(exception, "An error occurred while sending the request to the server.");
        }

        /// <summary>
        /// A partial method that gives developers a way to provide customized exception handling.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        partial void OnErrorGetWebhook(ref bool suppressDefaultLog, Exception exception, string pathFormat, string path, string merchantId, string webhookId);

        /// <summary>
        /// Get a webhook Returns the configuration for the webhook identified in the path.  To make this request, your API credential must have one of the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read * Management API—Webhooks read and write
        /// </summary>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="webhookId">Unique identifier of the webhook configuration.</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="IGetWebhookApiResponse"/>&gt;</returns>
        public async Task<IGetWebhookApiResponse> GetWebhookAsync(string merchantId, string webhookId, System.Threading.CancellationToken cancellationToken = default)
        {
            UriBuilder uriBuilder = new UriBuilder();

            try
            {
                ValidateGetWebhook(merchantId, webhookId);

                FormatGetWebhook(ref merchantId, ref webhookId);

                using (HttpRequestMessage httpRequestMessage = new HttpRequestMessage())
                {
                    uriBuilder.Host = HttpClient.BaseAddress!.Host;
                    uriBuilder.Port = HttpClient.BaseAddress.Port;
                    uriBuilder.Scheme = HttpClient.BaseAddress.Scheme;
                    uriBuilder.Path = HttpClient.BaseAddress.AbsolutePath == "/"
                        ? "/merchants/{merchantId}/webhooks/{webhookId}"
                        : string.Concat(HttpClient.BaseAddress.AbsolutePath, "/merchants/{merchantId}/webhooks/{webhookId}");
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BmerchantId%7D", Uri.EscapeDataString(merchantId.ToString()));
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BwebhookId%7D", Uri.EscapeDataString(webhookId.ToString()));

                    ApiKeyToken apiKeyToken2 = (ApiKeyToken) ApiKeyProvider.Get();
                    apiKeyToken2.AddTokenToHttpRequestMessageHeader(httpRequestMessage);
                    httpRequestMessage.RequestUri = uriBuilder.Uri;

                    string[] accepts = new string[] {
                        "application/json"
                    };

                    string? accept = ClientUtils.SelectHeaderAccept(accepts);

                    if (accept != null)
                        httpRequestMessage.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue(accept));

                    httpRequestMessage.Method = HttpMethod.Get;

                    DateTime requestedAt = DateTime.UtcNow;

                    using (HttpResponseMessage httpResponseMessage = await HttpClient.SendAsync(httpRequestMessage, cancellationToken).ConfigureAwait(false))
                    {
                        ILogger<WebhooksCompanyLevelService.GetWebhookApiResponse> apiResponseLogger = LoggerFactory.CreateLogger<WebhooksCompanyLevelService.GetWebhookApiResponse>();
                        WebhooksCompanyLevelService.GetWebhookApiResponse apiResponse;

                        switch ((int)httpResponseMessage.StatusCode) {
                            default: {
                                string responseContent = await httpResponseMessage.Content.ReadAsStringAsync(cancellationToken).ConfigureAwait(false);
                                apiResponse = new(apiResponseLogger, httpRequestMessage, httpResponseMessage, responseContent, "/merchants/{merchantId}/webhooks/{webhookId}", requestedAt, _jsonSerializerOptions);

                                break;
                            }
                        }

                        AfterGetWebhookDefaultImplementation(apiResponse, merchantId, webhookId);

                        Events.ExecuteOnGetWebhook(apiResponse);
                    
                        return apiResponse;
                    }
                }
            }
            catch(Exception e)
            {
                OnErrorGetWebhookDefaultImplementation(e, "/merchants/{merchantId}/webhooks/{webhookId}", uriBuilder.Path, merchantId, webhookId);
                Events.ExecuteOnErrorGetWebhook(e);
                throw;
            }
        }

        partial void FormatListAllWebhooks(ref string merchantId, ref Option<int> pageNumber, ref Option<int> pageSize);

        /// <summary>
        /// Validates the request parameters.
        /// </summary>
        /// <param name="merchantId"></param>
        /// <returns></returns>
        private void ValidateListAllWebhooks(string merchantId)
        {
            if (merchantId == null)
                throw new ArgumentNullException(nameof(merchantId));
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="pageNumber"></param>
        /// <param name="pageSize"></param>
        private void AfterListAllWebhooksDefaultImplementation(IListAllWebhooksApiResponse apiResponse, string merchantId, Option<int> pageNumber, Option<int> pageSize)
        {
            bool suppressDefaultLog = false;
            AfterListAllWebhooks(ref suppressDefaultLog, apiResponse, merchantId, pageNumber, pageSize);
            if (!suppressDefaultLog)
                Logger.LogInformation("{0,-9} | {1} | {3}", (apiResponse.DownloadedAt - apiResponse.RequestedAt).TotalSeconds, apiResponse.StatusCode, apiResponse.Path);
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="pageNumber"></param>
        /// <param name="pageSize"></param>
        partial void AfterListAllWebhooks(ref bool suppressDefaultLog, IListAllWebhooksApiResponse apiResponse, string merchantId, Option<int> pageNumber, Option<int> pageSize);

        /// <summary>
        /// Logs exceptions that occur while retrieving the server response.
        /// </summary>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="pageNumber"></param>
        /// <param name="pageSize"></param>
        private void OnErrorListAllWebhooksDefaultImplementation(Exception exception, string pathFormat, string path, string merchantId, Option<int> pageNumber, Option<int> pageSize)
        {
            bool suppressDefaultLog = false;
            OnErrorListAllWebhooks(ref suppressDefaultLog, exception, pathFormat, path, merchantId, pageNumber, pageSize);
            if (!suppressDefaultLog)
                Logger.LogError(exception, "An error occurred while sending the request to the server.");
        }

        /// <summary>
        /// A partial method that gives developers a way to provide customized exception handling.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="pageNumber"></param>
        /// <param name="pageSize"></param>
        partial void OnErrorListAllWebhooks(ref bool suppressDefaultLog, Exception exception, string pathFormat, string path, string merchantId, Option<int> pageNumber, Option<int> pageSize);

        /// <summary>
        /// List all webhooks Lists all webhook configurations for the merchant account.  &gt; This call does not return webhook configurations for the company account to which the specified merchant account belongs. You can see these in your Customer Area under **Developers** &gt; **Webhooks**.  To make this request, your API credential must have one of the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read * Management API—Webhooks read and write
        /// </summary>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="pageNumber">The number of the page to fetch. (optional)</param>
        /// <param name="pageSize">The number of items to have on a page, maximum 100. The default is 10 items on a page. (optional)</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="IListAllWebhooksApiResponse"/>&gt;</returns>
        public async Task<IListAllWebhooksApiResponse> ListAllWebhooksAsync(string merchantId, Option<int> pageNumber = default, Option<int> pageSize = default, System.Threading.CancellationToken cancellationToken = default)
        {
            UriBuilder uriBuilder = new UriBuilder();

            try
            {
                ValidateListAllWebhooks(merchantId);

                FormatListAllWebhooks(ref merchantId, ref pageNumber, ref pageSize);

                using (HttpRequestMessage httpRequestMessage = new HttpRequestMessage())
                {
                    uriBuilder.Host = HttpClient.BaseAddress!.Host;
                    uriBuilder.Port = HttpClient.BaseAddress.Port;
                    uriBuilder.Scheme = HttpClient.BaseAddress.Scheme;
                    uriBuilder.Path = HttpClient.BaseAddress.AbsolutePath == "/"
                        ? "/merchants/{merchantId}/webhooks"
                        : string.Concat(HttpClient.BaseAddress.AbsolutePath, "/merchants/{merchantId}/webhooks");
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BmerchantId%7D", Uri.EscapeDataString(merchantId.ToString()));

                    System.Collections.Specialized.NameValueCollection parseQueryString = System.Web.HttpUtility.ParseQueryString(string.Empty);

                    if (pageNumber.IsSet)
                        parseQueryString["pageNumber"] = ClientUtils.ParameterToString(pageNumber.Value);

                    if (pageSize.IsSet)
                        parseQueryString["pageSize"] = ClientUtils.ParameterToString(pageSize.Value);

                    uriBuilder.Query = parseQueryString.ToString();

                    ApiKeyToken apiKeyToken2 = (ApiKeyToken) ApiKeyProvider.Get();
                    apiKeyToken2.AddTokenToHttpRequestMessageHeader(httpRequestMessage);
                    httpRequestMessage.RequestUri = uriBuilder.Uri;

                    string[] accepts = new string[] {
                        "application/json"
                    };

                    string? accept = ClientUtils.SelectHeaderAccept(accepts);

                    if (accept != null)
                        httpRequestMessage.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue(accept));

                    httpRequestMessage.Method = HttpMethod.Get;

                    DateTime requestedAt = DateTime.UtcNow;

                    using (HttpResponseMessage httpResponseMessage = await HttpClient.SendAsync(httpRequestMessage, cancellationToken).ConfigureAwait(false))
                    {
                        ILogger<WebhooksCompanyLevelService.ListAllWebhooksApiResponse> apiResponseLogger = LoggerFactory.CreateLogger<WebhooksCompanyLevelService.ListAllWebhooksApiResponse>();
                        WebhooksCompanyLevelService.ListAllWebhooksApiResponse apiResponse;

                        switch ((int)httpResponseMessage.StatusCode) {
                            default: {
                                string responseContent = await httpResponseMessage.Content.ReadAsStringAsync(cancellationToken).ConfigureAwait(false);
                                apiResponse = new(apiResponseLogger, httpRequestMessage, httpResponseMessage, responseContent, "/merchants/{merchantId}/webhooks", requestedAt, _jsonSerializerOptions);

                                break;
                            }
                        }

                        AfterListAllWebhooksDefaultImplementation(apiResponse, merchantId, pageNumber, pageSize);

                        Events.ExecuteOnListAllWebhooks(apiResponse);
                    
                        return apiResponse;
                    }
                }
            }
            catch(Exception e)
            {
                OnErrorListAllWebhooksDefaultImplementation(e, "/merchants/{merchantId}/webhooks", uriBuilder.Path, merchantId, pageNumber, pageSize);
                Events.ExecuteOnErrorListAllWebhooks(e);
                throw;
            }
        }

        partial void FormatRemoveWebhook(ref string merchantId, ref string webhookId);

        /// <summary>
        /// Validates the request parameters.
        /// </summary>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <returns></returns>
        private void ValidateRemoveWebhook(string merchantId, string webhookId)
        {
            if (merchantId == null)
                throw new ArgumentNullException(nameof(merchantId));

            if (webhookId == null)
                throw new ArgumentNullException(nameof(webhookId));
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        private void AfterRemoveWebhookDefaultImplementation(IRemoveWebhookApiResponse apiResponse, string merchantId, string webhookId)
        {
            bool suppressDefaultLog = false;
            AfterRemoveWebhook(ref suppressDefaultLog, apiResponse, merchantId, webhookId);
            if (!suppressDefaultLog)
                Logger.LogInformation("{0,-9} | {1} | {3}", (apiResponse.DownloadedAt - apiResponse.RequestedAt).TotalSeconds, apiResponse.StatusCode, apiResponse.Path);
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        partial void AfterRemoveWebhook(ref bool suppressDefaultLog, IRemoveWebhookApiResponse apiResponse, string merchantId, string webhookId);

        /// <summary>
        /// Logs exceptions that occur while retrieving the server response.
        /// </summary>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        private void OnErrorRemoveWebhookDefaultImplementation(Exception exception, string pathFormat, string path, string merchantId, string webhookId)
        {
            bool suppressDefaultLog = false;
            OnErrorRemoveWebhook(ref suppressDefaultLog, exception, pathFormat, path, merchantId, webhookId);
            if (!suppressDefaultLog)
                Logger.LogError(exception, "An error occurred while sending the request to the server.");
        }

        /// <summary>
        /// A partial method that gives developers a way to provide customized exception handling.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        partial void OnErrorRemoveWebhook(ref bool suppressDefaultLog, Exception exception, string pathFormat, string path, string merchantId, string webhookId);

        /// <summary>
        /// Remove a webhook Remove the configuration for the webhook identified in the path.  To make this request, your API credential must have the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read and write
        /// </summary>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="webhookId">Unique identifier of the webhook configuration.</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="IRemoveWebhookApiResponse"/>&gt;</returns>
        public async Task<IRemoveWebhookApiResponse> RemoveWebhookAsync(string merchantId, string webhookId, System.Threading.CancellationToken cancellationToken = default)
        {
            UriBuilder uriBuilder = new UriBuilder();

            try
            {
                ValidateRemoveWebhook(merchantId, webhookId);

                FormatRemoveWebhook(ref merchantId, ref webhookId);

                using (HttpRequestMessage httpRequestMessage = new HttpRequestMessage())
                {
                    uriBuilder.Host = HttpClient.BaseAddress!.Host;
                    uriBuilder.Port = HttpClient.BaseAddress.Port;
                    uriBuilder.Scheme = HttpClient.BaseAddress.Scheme;
                    uriBuilder.Path = HttpClient.BaseAddress.AbsolutePath == "/"
                        ? "/merchants/{merchantId}/webhooks/{webhookId}"
                        : string.Concat(HttpClient.BaseAddress.AbsolutePath, "/merchants/{merchantId}/webhooks/{webhookId}");
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BmerchantId%7D", Uri.EscapeDataString(merchantId.ToString()));
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BwebhookId%7D", Uri.EscapeDataString(webhookId.ToString()));

                    ApiKeyToken apiKeyToken2 = (ApiKeyToken) ApiKeyProvider.Get();
                    apiKeyToken2.AddTokenToHttpRequestMessageHeader(httpRequestMessage);
                    httpRequestMessage.RequestUri = uriBuilder.Uri;

                    string[] accepts = new string[] {
                        "application/json"
                    };

                    string? accept = ClientUtils.SelectHeaderAccept(accepts);

                    if (accept != null)
                        httpRequestMessage.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue(accept));

                    httpRequestMessage.Method = HttpMethod.Delete;

                    DateTime requestedAt = DateTime.UtcNow;

                    using (HttpResponseMessage httpResponseMessage = await HttpClient.SendAsync(httpRequestMessage, cancellationToken).ConfigureAwait(false))
                    {
                        ILogger<WebhooksCompanyLevelService.RemoveWebhookApiResponse> apiResponseLogger = LoggerFactory.CreateLogger<WebhooksCompanyLevelService.RemoveWebhookApiResponse>();
                        WebhooksCompanyLevelService.RemoveWebhookApiResponse apiResponse;

                        switch ((int)httpResponseMessage.StatusCode) {
                            default: {
                                string responseContent = await httpResponseMessage.Content.ReadAsStringAsync(cancellationToken).ConfigureAwait(false);
                                apiResponse = new(apiResponseLogger, httpRequestMessage, httpResponseMessage, responseContent, "/merchants/{merchantId}/webhooks/{webhookId}", requestedAt, _jsonSerializerOptions);

                                break;
                            }
                        }

                        AfterRemoveWebhookDefaultImplementation(apiResponse, merchantId, webhookId);

                        Events.ExecuteOnRemoveWebhook(apiResponse);
                    
                        return apiResponse;
                    }
                }
            }
            catch(Exception e)
            {
                OnErrorRemoveWebhookDefaultImplementation(e, "/merchants/{merchantId}/webhooks/{webhookId}", uriBuilder.Path, merchantId, webhookId);
                Events.ExecuteOnErrorRemoveWebhook(e);
                throw;
            }
        }

        partial void FormatSetUpWebhook(ref string merchantId, Option<CreateMerchantWebhookRequest> createMerchantWebhookRequest);

        /// <summary>
        /// Validates the request parameters.
        /// </summary>
        /// <param name="merchantId"></param>
        /// <param name="createMerchantWebhookRequest"></param>
        /// <returns></returns>
        private void ValidateSetUpWebhook(string merchantId, Option<CreateMerchantWebhookRequest> createMerchantWebhookRequest)
        {
            if (merchantId == null)
                throw new ArgumentNullException(nameof(merchantId));

            if (createMerchantWebhookRequest.IsSet && createMerchantWebhookRequest.Value == null)
                throw new ArgumentNullException(nameof(createMerchantWebhookRequest));
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="createMerchantWebhookRequest"></param>
        private void AfterSetUpWebhookDefaultImplementation(ISetUpWebhookApiResponse apiResponse, string merchantId, Option<CreateMerchantWebhookRequest> createMerchantWebhookRequest)
        {
            bool suppressDefaultLog = false;
            AfterSetUpWebhook(ref suppressDefaultLog, apiResponse, merchantId, createMerchantWebhookRequest);
            if (!suppressDefaultLog)
                Logger.LogInformation("{0,-9} | {1} | {3}", (apiResponse.DownloadedAt - apiResponse.RequestedAt).TotalSeconds, apiResponse.StatusCode, apiResponse.Path);
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="createMerchantWebhookRequest"></param>
        partial void AfterSetUpWebhook(ref bool suppressDefaultLog, ISetUpWebhookApiResponse apiResponse, string merchantId, Option<CreateMerchantWebhookRequest> createMerchantWebhookRequest);

        /// <summary>
        /// Logs exceptions that occur while retrieving the server response.
        /// </summary>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="createMerchantWebhookRequest"></param>
        private void OnErrorSetUpWebhookDefaultImplementation(Exception exception, string pathFormat, string path, string merchantId, Option<CreateMerchantWebhookRequest> createMerchantWebhookRequest)
        {
            bool suppressDefaultLog = false;
            OnErrorSetUpWebhook(ref suppressDefaultLog, exception, pathFormat, path, merchantId, createMerchantWebhookRequest);
            if (!suppressDefaultLog)
                Logger.LogError(exception, "An error occurred while sending the request to the server.");
        }

        /// <summary>
        /// A partial method that gives developers a way to provide customized exception handling.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="createMerchantWebhookRequest"></param>
        partial void OnErrorSetUpWebhook(ref bool suppressDefaultLog, Exception exception, string pathFormat, string path, string merchantId, Option<CreateMerchantWebhookRequest> createMerchantWebhookRequest);

        /// <summary>
        /// Set up a webhook Subscribe to receive webhook notifications about events related to your merchant account. You can add basic authentication to make sure the data is secure.  To make this request, your API credential must have the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read and write
        /// </summary>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="createMerchantWebhookRequest"> (optional)</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="ISetUpWebhookApiResponse"/>&gt;</returns>
        public async Task<ISetUpWebhookApiResponse> SetUpWebhookAsync(string merchantId, Option<CreateMerchantWebhookRequest> createMerchantWebhookRequest = default, System.Threading.CancellationToken cancellationToken = default)
        {
            UriBuilder uriBuilder = new UriBuilder();

            try
            {
                ValidateSetUpWebhook(merchantId, createMerchantWebhookRequest);

                FormatSetUpWebhook(ref merchantId, createMerchantWebhookRequest);

                using (HttpRequestMessage httpRequestMessage = new HttpRequestMessage())
                {
                    uriBuilder.Host = HttpClient.BaseAddress!.Host;
                    uriBuilder.Port = HttpClient.BaseAddress.Port;
                    uriBuilder.Scheme = HttpClient.BaseAddress.Scheme;
                    uriBuilder.Path = HttpClient.BaseAddress.AbsolutePath == "/"
                        ? "/merchants/{merchantId}/webhooks"
                        : string.Concat(HttpClient.BaseAddress.AbsolutePath, "/merchants/{merchantId}/webhooks");
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BmerchantId%7D", Uri.EscapeDataString(merchantId.ToString()));

                    if (createMerchantWebhookRequest.IsSet)
                        httpRequestMessage.Content = (createMerchantWebhookRequest.Value as object) is System.IO.Stream stream
                            ? httpRequestMessage.Content = new StreamContent(stream)
                            : httpRequestMessage.Content = new StringContent(JsonSerializer.Serialize(createMerchantWebhookRequest.Value, _jsonSerializerOptions));

                    ApiKeyToken apiKeyToken2 = (ApiKeyToken) ApiKeyProvider.Get();
                    apiKeyToken2.AddTokenToHttpRequestMessageHeader(httpRequestMessage);
                    httpRequestMessage.RequestUri = uriBuilder.Uri;

                    string[] contentTypes = new string[] {
                        "application/json"
                    };

                    string? contentType = ClientUtils.SelectHeaderContentType(contentTypes);

                    if (contentType != null && httpRequestMessage.Content != null)
                        httpRequestMessage.Content.Headers.ContentType = new MediaTypeHeaderValue(contentType);

                    string[] accepts = new string[] {
                        "application/json"
                    };

                    string? accept = ClientUtils.SelectHeaderAccept(accepts);

                    if (accept != null)
                        httpRequestMessage.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue(accept));

                    httpRequestMessage.Method = HttpMethod.Post;

                    DateTime requestedAt = DateTime.UtcNow;

                    using (HttpResponseMessage httpResponseMessage = await HttpClient.SendAsync(httpRequestMessage, cancellationToken).ConfigureAwait(false))
                    {
                        ILogger<WebhooksCompanyLevelService.SetUpWebhookApiResponse> apiResponseLogger = LoggerFactory.CreateLogger<WebhooksCompanyLevelService.SetUpWebhookApiResponse>();
                        WebhooksCompanyLevelService.SetUpWebhookApiResponse apiResponse;

                        switch ((int)httpResponseMessage.StatusCode) {
                            default: {
                                string responseContent = await httpResponseMessage.Content.ReadAsStringAsync(cancellationToken).ConfigureAwait(false);
                                apiResponse = new(apiResponseLogger, httpRequestMessage, httpResponseMessage, responseContent, "/merchants/{merchantId}/webhooks", requestedAt, _jsonSerializerOptions);

                                break;
                            }
                        }

                        AfterSetUpWebhookDefaultImplementation(apiResponse, merchantId, createMerchantWebhookRequest);

                        Events.ExecuteOnSetUpWebhook(apiResponse);
                    
                        return apiResponse;
                    }
                }
            }
            catch(Exception e)
            {
                OnErrorSetUpWebhookDefaultImplementation(e, "/merchants/{merchantId}/webhooks", uriBuilder.Path, merchantId, createMerchantWebhookRequest);
                Events.ExecuteOnErrorSetUpWebhook(e);
                throw;
            }
        }

        partial void FormatTestWebhook(ref string merchantId, ref string webhookId, Option<TestWebhookRequest> testWebhookRequest);

        /// <summary>
        /// Validates the request parameters.
        /// </summary>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <param name="testWebhookRequest"></param>
        /// <returns></returns>
        private void ValidateTestWebhook(string merchantId, string webhookId, Option<TestWebhookRequest> testWebhookRequest)
        {
            if (merchantId == null)
                throw new ArgumentNullException(nameof(merchantId));

            if (webhookId == null)
                throw new ArgumentNullException(nameof(webhookId));

            if (testWebhookRequest.IsSet && testWebhookRequest.Value == null)
                throw new ArgumentNullException(nameof(testWebhookRequest));
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <param name="testWebhookRequest"></param>
        private void AfterTestWebhookDefaultImplementation(ITestWebhookApiResponse apiResponse, string merchantId, string webhookId, Option<TestWebhookRequest> testWebhookRequest)
        {
            bool suppressDefaultLog = false;
            AfterTestWebhook(ref suppressDefaultLog, apiResponse, merchantId, webhookId, testWebhookRequest);
            if (!suppressDefaultLog)
                Logger.LogInformation("{0,-9} | {1} | {3}", (apiResponse.DownloadedAt - apiResponse.RequestedAt).TotalSeconds, apiResponse.StatusCode, apiResponse.Path);
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <param name="testWebhookRequest"></param>
        partial void AfterTestWebhook(ref bool suppressDefaultLog, ITestWebhookApiResponse apiResponse, string merchantId, string webhookId, Option<TestWebhookRequest> testWebhookRequest);

        /// <summary>
        /// Logs exceptions that occur while retrieving the server response.
        /// </summary>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <param name="testWebhookRequest"></param>
        private void OnErrorTestWebhookDefaultImplementation(Exception exception, string pathFormat, string path, string merchantId, string webhookId, Option<TestWebhookRequest> testWebhookRequest)
        {
            bool suppressDefaultLog = false;
            OnErrorTestWebhook(ref suppressDefaultLog, exception, pathFormat, path, merchantId, webhookId, testWebhookRequest);
            if (!suppressDefaultLog)
                Logger.LogError(exception, "An error occurred while sending the request to the server.");
        }

        /// <summary>
        /// A partial method that gives developers a way to provide customized exception handling.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <param name="testWebhookRequest"></param>
        partial void OnErrorTestWebhook(ref bool suppressDefaultLog, Exception exception, string pathFormat, string path, string merchantId, string webhookId, Option<TestWebhookRequest> testWebhookRequest);

        /// <summary>
        /// Test a webhook Sends sample notifications to test if the webhook is set up correctly.  We send four test notifications for each event code you choose. They cover success and failure scenarios for the hard-coded currencies EUR and GBP, regardless of the currencies configured in the merchant accounts. For custom notifications, we only send the specified custom notification.  The response describes the result of the test. The &#x60;status&#x60; field tells you if the test was successful or not. You can use the other fields to troubleshoot unsuccessful tests.  To make this request, your API credential must have the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read and write
        /// </summary>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="webhookId">Unique identifier of the webhook configuration.</param>
        /// <param name="testWebhookRequest"> (optional)</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="ITestWebhookApiResponse"/>&gt;</returns>
        public async Task<ITestWebhookApiResponse> TestWebhookAsync(string merchantId, string webhookId, Option<TestWebhookRequest> testWebhookRequest = default, System.Threading.CancellationToken cancellationToken = default)
        {
            UriBuilder uriBuilder = new UriBuilder();

            try
            {
                ValidateTestWebhook(merchantId, webhookId, testWebhookRequest);

                FormatTestWebhook(ref merchantId, ref webhookId, testWebhookRequest);

                using (HttpRequestMessage httpRequestMessage = new HttpRequestMessage())
                {
                    uriBuilder.Host = HttpClient.BaseAddress!.Host;
                    uriBuilder.Port = HttpClient.BaseAddress.Port;
                    uriBuilder.Scheme = HttpClient.BaseAddress.Scheme;
                    uriBuilder.Path = HttpClient.BaseAddress.AbsolutePath == "/"
                        ? "/merchants/{merchantId}/webhooks/{webhookId}/test"
                        : string.Concat(HttpClient.BaseAddress.AbsolutePath, "/merchants/{merchantId}/webhooks/{webhookId}/test");
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BmerchantId%7D", Uri.EscapeDataString(merchantId.ToString()));
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BwebhookId%7D", Uri.EscapeDataString(webhookId.ToString()));

                    if (testWebhookRequest.IsSet)
                        httpRequestMessage.Content = (testWebhookRequest.Value as object) is System.IO.Stream stream
                            ? httpRequestMessage.Content = new StreamContent(stream)
                            : httpRequestMessage.Content = new StringContent(JsonSerializer.Serialize(testWebhookRequest.Value, _jsonSerializerOptions));

                    ApiKeyToken apiKeyToken2 = (ApiKeyToken) ApiKeyProvider.Get();
                    apiKeyToken2.AddTokenToHttpRequestMessageHeader(httpRequestMessage);
                    httpRequestMessage.RequestUri = uriBuilder.Uri;

                    string[] contentTypes = new string[] {
                        "application/json"
                    };

                    string? contentType = ClientUtils.SelectHeaderContentType(contentTypes);

                    if (contentType != null && httpRequestMessage.Content != null)
                        httpRequestMessage.Content.Headers.ContentType = new MediaTypeHeaderValue(contentType);

                    string[] accepts = new string[] {
                        "application/json"
                    };

                    string? accept = ClientUtils.SelectHeaderAccept(accepts);

                    if (accept != null)
                        httpRequestMessage.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue(accept));

                    httpRequestMessage.Method = HttpMethod.Post;

                    DateTime requestedAt = DateTime.UtcNow;

                    using (HttpResponseMessage httpResponseMessage = await HttpClient.SendAsync(httpRequestMessage, cancellationToken).ConfigureAwait(false))
                    {
                        ILogger<WebhooksCompanyLevelService.TestWebhookApiResponse> apiResponseLogger = LoggerFactory.CreateLogger<WebhooksCompanyLevelService.TestWebhookApiResponse>();
                        WebhooksCompanyLevelService.TestWebhookApiResponse apiResponse;

                        switch ((int)httpResponseMessage.StatusCode) {
                            default: {
                                string responseContent = await httpResponseMessage.Content.ReadAsStringAsync(cancellationToken).ConfigureAwait(false);
                                apiResponse = new(apiResponseLogger, httpRequestMessage, httpResponseMessage, responseContent, "/merchants/{merchantId}/webhooks/{webhookId}/test", requestedAt, _jsonSerializerOptions);

                                break;
                            }
                        }

                        AfterTestWebhookDefaultImplementation(apiResponse, merchantId, webhookId, testWebhookRequest);

                        Events.ExecuteOnTestWebhook(apiResponse);
                    
                        return apiResponse;
                    }
                }
            }
            catch(Exception e)
            {
                OnErrorTestWebhookDefaultImplementation(e, "/merchants/{merchantId}/webhooks/{webhookId}/test", uriBuilder.Path, merchantId, webhookId, testWebhookRequest);
                Events.ExecuteOnErrorTestWebhook(e);
                throw;
            }
        }

        partial void FormatUpdateWebhook(ref string merchantId, ref string webhookId, Option<UpdateMerchantWebhookRequest> updateMerchantWebhookRequest);

        /// <summary>
        /// Validates the request parameters.
        /// </summary>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <param name="updateMerchantWebhookRequest"></param>
        /// <returns></returns>
        private void ValidateUpdateWebhook(string merchantId, string webhookId, Option<UpdateMerchantWebhookRequest> updateMerchantWebhookRequest)
        {
            if (merchantId == null)
                throw new ArgumentNullException(nameof(merchantId));

            if (webhookId == null)
                throw new ArgumentNullException(nameof(webhookId));

            if (updateMerchantWebhookRequest.IsSet && updateMerchantWebhookRequest.Value == null)
                throw new ArgumentNullException(nameof(updateMerchantWebhookRequest));
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <param name="updateMerchantWebhookRequest"></param>
        private void AfterUpdateWebhookDefaultImplementation(IUpdateWebhookApiResponse apiResponse, string merchantId, string webhookId, Option<UpdateMerchantWebhookRequest> updateMerchantWebhookRequest)
        {
            bool suppressDefaultLog = false;
            AfterUpdateWebhook(ref suppressDefaultLog, apiResponse, merchantId, webhookId, updateMerchantWebhookRequest);
            if (!suppressDefaultLog)
                Logger.LogInformation("{0,-9} | {1} | {3}", (apiResponse.DownloadedAt - apiResponse.RequestedAt).TotalSeconds, apiResponse.StatusCode, apiResponse.Path);
        }

        /// <summary>
        /// Processes the server response.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="apiResponse"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <param name="updateMerchantWebhookRequest"></param>
        partial void AfterUpdateWebhook(ref bool suppressDefaultLog, IUpdateWebhookApiResponse apiResponse, string merchantId, string webhookId, Option<UpdateMerchantWebhookRequest> updateMerchantWebhookRequest);

        /// <summary>
        /// Logs exceptions that occur while retrieving the server response.
        /// </summary>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <param name="updateMerchantWebhookRequest"></param>
        private void OnErrorUpdateWebhookDefaultImplementation(Exception exception, string pathFormat, string path, string merchantId, string webhookId, Option<UpdateMerchantWebhookRequest> updateMerchantWebhookRequest)
        {
            bool suppressDefaultLog = false;
            OnErrorUpdateWebhook(ref suppressDefaultLog, exception, pathFormat, path, merchantId, webhookId, updateMerchantWebhookRequest);
            if (!suppressDefaultLog)
                Logger.LogError(exception, "An error occurred while sending the request to the server.");
        }

        /// <summary>
        /// A partial method that gives developers a way to provide customized exception handling.
        /// </summary>
        /// <param name="suppressDefaultLog"></param>
        /// <param name="exception"></param>
        /// <param name="pathFormat"></param>
        /// <param name="path"></param>
        /// <param name="merchantId"></param>
        /// <param name="webhookId"></param>
        /// <param name="updateMerchantWebhookRequest"></param>
        partial void OnErrorUpdateWebhook(ref bool suppressDefaultLog, Exception exception, string pathFormat, string path, string merchantId, string webhookId, Option<UpdateMerchantWebhookRequest> updateMerchantWebhookRequest);

        /// <summary>
        /// Update a webhook Make changes to the configuration of the webhook identified in the path. The request contains the new values you want to have in the webhook configuration. The response contains the full configuration for the webhook, which includes the new values from the request.  To make this request, your API credential must have the following [roles](https://docs.adyen.com/development-resources/api-credentials#api-permissions): * Management API—Webhooks read and write
        /// </summary>
        /// <exception cref="ApiException">Thrown when fails to make API call.</exception>
        /// <param name="merchantId">The unique identifier of the merchant account.</param>
        /// <param name="webhookId">Unique identifier of the webhook configuration.</param>
        /// <param name="updateMerchantWebhookRequest"> (optional)</param>
        /// <param name="cancellationToken">Cancellation Token to cancel the request.</param>
        /// <returns><see cref="Task"/>&lt;<see cref="IUpdateWebhookApiResponse"/>&gt;</returns>
        public async Task<IUpdateWebhookApiResponse> UpdateWebhookAsync(string merchantId, string webhookId, Option<UpdateMerchantWebhookRequest> updateMerchantWebhookRequest = default, System.Threading.CancellationToken cancellationToken = default)
        {
            UriBuilder uriBuilder = new UriBuilder();

            try
            {
                ValidateUpdateWebhook(merchantId, webhookId, updateMerchantWebhookRequest);

                FormatUpdateWebhook(ref merchantId, ref webhookId, updateMerchantWebhookRequest);

                using (HttpRequestMessage httpRequestMessage = new HttpRequestMessage())
                {
                    uriBuilder.Host = HttpClient.BaseAddress!.Host;
                    uriBuilder.Port = HttpClient.BaseAddress.Port;
                    uriBuilder.Scheme = HttpClient.BaseAddress.Scheme;
                    uriBuilder.Path = HttpClient.BaseAddress.AbsolutePath == "/"
                        ? "/merchants/{merchantId}/webhooks/{webhookId}"
                        : string.Concat(HttpClient.BaseAddress.AbsolutePath, "/merchants/{merchantId}/webhooks/{webhookId}");
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BmerchantId%7D", Uri.EscapeDataString(merchantId.ToString()));
                    uriBuilder.Path = uriBuilder.Path.Replace("%7BwebhookId%7D", Uri.EscapeDataString(webhookId.ToString()));

                    if (updateMerchantWebhookRequest.IsSet)
                        httpRequestMessage.Content = (updateMerchantWebhookRequest.Value as object) is System.IO.Stream stream
                            ? httpRequestMessage.Content = new StreamContent(stream)
                            : httpRequestMessage.Content = new StringContent(JsonSerializer.Serialize(updateMerchantWebhookRequest.Value, _jsonSerializerOptions));

                    ApiKeyToken apiKeyToken2 = (ApiKeyToken) ApiKeyProvider.Get();
                    apiKeyToken2.AddTokenToHttpRequestMessageHeader(httpRequestMessage);
                    httpRequestMessage.RequestUri = uriBuilder.Uri;

                    string[] contentTypes = new string[] {
                        "application/json"
                    };

                    string? contentType = ClientUtils.SelectHeaderContentType(contentTypes);

                    if (contentType != null && httpRequestMessage.Content != null)
                        httpRequestMessage.Content.Headers.ContentType = new MediaTypeHeaderValue(contentType);

                    string[] accepts = new string[] {
                        "application/json"
                    };

                    string? accept = ClientUtils.SelectHeaderAccept(accepts);

                    if (accept != null)
                        httpRequestMessage.Headers.Accept.Add(new MediaTypeWithQualityHeaderValue(accept));

                    httpRequestMessage.Method = HttpMethod.Patch;

                    DateTime requestedAt = DateTime.UtcNow;

                    using (HttpResponseMessage httpResponseMessage = await HttpClient.SendAsync(httpRequestMessage, cancellationToken).ConfigureAwait(false))
                    {
                        ILogger<WebhooksCompanyLevelService.UpdateWebhookApiResponse> apiResponseLogger = LoggerFactory.CreateLogger<WebhooksCompanyLevelService.UpdateWebhookApiResponse>();
                        WebhooksCompanyLevelService.UpdateWebhookApiResponse apiResponse;

                        switch ((int)httpResponseMessage.StatusCode) {
                            default: {
                                string responseContent = await httpResponseMessage.Content.ReadAsStringAsync(cancellationToken).ConfigureAwait(false);
                                apiResponse = new(apiResponseLogger, httpRequestMessage, httpResponseMessage, responseContent, "/merchants/{merchantId}/webhooks/{webhookId}", requestedAt, _jsonSerializerOptions);

                                break;
                            }
                        }

                        AfterUpdateWebhookDefaultImplementation(apiResponse, merchantId, webhookId, updateMerchantWebhookRequest);

                        Events.ExecuteOnUpdateWebhook(apiResponse);
                    
                        return apiResponse;
                    }
                }
            }
            catch(Exception e)
            {
                OnErrorUpdateWebhookDefaultImplementation(e, "/merchants/{merchantId}/webhooks/{webhookId}", uriBuilder.Path, merchantId, webhookId, updateMerchantWebhookRequest);
                Events.ExecuteOnErrorUpdateWebhook(e);
                throw;
            }
        }
    }
}
